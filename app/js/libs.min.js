!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("Az",e):t.Az=e()}(this,function(){"use strict";if("undefined"!=typeof require&&"object"==typeof exports&&"undefined"!=typeof module)var n=require("fs");return{load:function(t,s,o){if(n)n.readFile(t,{encoding:"json"==s?"utf8":null},function(t,e){if(t)o(t);else if("json"==s)o(null,JSON.parse(e));else if("arraybuffer"==s)if(e.buffer)o(null,e.buffer);else{for(var n=new ArrayBuffer(e.length),r=new Uint8Array(n),i=0;i<e.length;++i)r[i]=e[i];o(null,n)}else o(new Error("Unknown responseType"))});else{var e=new XMLHttpRequest;e.open("GET",t,!0),e.responseType=s,e.onload=function(t){e.response&&o&&o(null,e.response)},e.send(null)}},extend:function(){for(var t={},e=0;e<arguments.length;e++)for(var n in arguments[e])t[n]=arguments[e][n];return t}}}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?(module.exports=module.exports||{})&&(module.exports.DAWG=e(module.exports)):"function"==typeof define&&define.amd?define("Az.DAWG",["Az"],e):(t.Az=t.Az||{})&&(t.Az.DAWG=e(t.Az))}(this,function(e){"use strict";function r(t){return t>>10<<((512&t)>>6)&i}var m=-1,i=4294967295,y={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10,11:11,12:12,13:13,14:14,15:15,16:16,17:17,18:18,19:19,20:20,21:21,22:22,23:23,24:24,25:25,26:26,27:27,28:28,29:29,30:30,31:31,32:32,33:33,34:34,35:35,36:36,37:37,38:38,39:39,40:40,41:41,42:42,43:43,44:44,45:45,46:46,47:47,48:48,49:49,50:50,51:51,52:52,53:53,54:54,55:55,56:56,57:57,58:58,59:59,60:60,61:61,62:62,63:63,64:64,65:65,66:66,67:67,68:68,69:69,70:70,71:71,72:72,73:73,74:74,75:75,76:76,77:77,78:78,79:79,80:80,81:81,82:82,83:83,84:84,85:85,86:86,87:87,88:88,89:89,90:90,91:91,92:92,93:93,94:94,95:95,96:96,97:97,98:98,99:99,100:100,101:101,102:102,103:103,104:104,105:105,106:106,107:107,108:108,109:109,110:110,111:111,112:112,113:113,114:114,115:115,116:116,117:117,118:118,119:119,120:120,121:121,122:122,123:123,124:124,125:125,126:126,127:127,1027:129,8225:135,1046:198,8222:132,1047:199,1168:165,1048:200,1113:154,1049:201,1045:197,1050:202,1028:170,160:160,1040:192,1051:203,164:164,166:166,167:167,169:169,171:171,172:172,173:173,174:174,1053:205,176:176,177:177,1114:156,181:181,182:182,183:183,8221:148,187:187,1029:189,1056:208,1057:209,1058:210,8364:136,1112:188,1115:158,1059:211,1060:212,1030:178,1061:213,1062:214,1063:215,1116:157,1064:216,1065:217,1031:175,1066:218,1067:219,1068:220,1069:221,1070:222,1032:163,8226:149,1071:223,1072:224,8482:153,1073:225,8240:137,1118:162,1074:226,1110:179,8230:133,1075:227,1033:138,1076:228,1077:229,8211:150,1078:230,1119:159,1079:231,1042:194,1080:232,1034:140,1025:168,1081:233,1082:234,8212:151,1083:235,1169:180,1084:236,1052:204,1085:237,1035:142,1086:238,1087:239,1088:240,1089:241,1090:242,1036:141,1041:193,1091:243,1092:244,8224:134,1093:245,8470:185,1094:246,1054:206,1095:247,1096:248,8249:139,1097:249,1098:250,1044:196,1099:251,1111:191,1055:207,1100:252,1038:161,8220:147,1101:253,8250:155,1102:254,8216:145,1103:255,1043:195,1105:184,1039:143,1026:128,1106:144,8218:130,1107:131,8217:146,1108:186,1109:190},b={};for(var t in y)b[y[t]]=String.fromCharCode(t),delete b[0],delete b[1];function s(t,e,n){this.units=t,this.guide=e,this.format=n}var v={"й":"ёцыф","ц":"йфыву","у":"цывак","к":"увапе","е":"капрн","н":"епрог","г":"нролш","ш":"голдщ","щ":"шлджз","з":"щджэх-","х":"зжэъ-","ъ":"хэ-ё","ф":"йцычяё","ы":"йцувсчяф","в":"цукамсчы","а":"укепимсв","п":"кенртима","р":"енгоьтип","о":"нгшлбьтр","л":"гшщдюбьо","д":"шщзжюбл","ж":"щзхэюд","э":"зхъжё","ё":"йфяъэ","я":"ёфыч","ч":"яфывс","с":"чывам","м":"свапи","и":"мапрт","т":"ипроь","ь":"тролб","б":"ьолдю","ю":"блдж",1:"ёйц",2:"йцу",3:"цук",4:"уке",5:"кен",6:"енг",7:"нгш",8:"гшщ",9:"шщз",0:"щзх-","-":"зхъ","=":"-хъ","\\":"ъэ",".":"южэ"};return s.fromArrayBuffer=function(t,e){var n=new DataView(t),r=n.getUint32(0,!0),i=n.getUint32(4*r+4,!0);return new s(new Uint32Array(t,4,r),new Uint8Array(t,4*r+8,2*i),e)},s.load=function(t,n,r){e.load(t,"arraybuffer",function(t,e){r(t,t?null:s.fromArrayBuffer(e,n))})},s.prototype.followByte=function(t,e){var n=(e^r(this.units[e])^255&t)&i;return function(t){return t&(255|1<<31)&i}(this.units[n])!=(255&t)?m:n},s.prototype.followString=function(t,e){e=e||0;for(var n=0;n<t.length;n++){var r=t.charCodeAt(n);if(!(r in y))return m;if((e=this.followByte(y[r],e))==m)return m}return e},s.prototype.hasValue=function(t){return function(t){return 0!=(256&t&i)}(this.units[t])},s.prototype.value=function(t){var e=(t^r(this.units[t]))&i;return function(t){return t&~(1<<31)&i}(this.units[e])},s.prototype.find=function(t){var e=this.followString(t);return e==m?m:this.hasValue(e)?this.value(e):m},s.prototype.iterateAll=function(t){for(var e=[],n=[t],r=[],i=0;;){if(t=n[n.length-1],0!=i)if(s=this.guide[t<<1]){if((t=this.followByte(s,t))==m)return e;r.push(s),n.push(t)}else do{if(s=this.guide[1+(t<<1)],r.pop(),n.pop(),!n.length)return e;if(t=n[n.length-1],s){if((t=this.followByte(s,t))==m)return e;r.push(s),n.push(t)}}while(!s);for(;!this.hasValue(t);){var s=this.guide[t<<1];if((t=this.followByte(s,t))==m)return e;r.push(s),n.push(t)}"words"==this.format?e.push([((1^r[0])<<6)+(r[1]>>1),((1^r[2])<<6)+(r[3]>>1)]):"probs"==this.format?e.push([((1^r[0])<<6)+(r[1]>>1),((1^r[2])<<6)+(r[3]>>1),((1^r[4])<<6)+(r[5]>>1)]):e.push(r.slice()),i=t}},s.prototype.findAll=function(t,e,n,r){r=r||0,n=n||0;for(var i,s,o,a,l,h,u,p=[],c=[["",0,0,0,0]];c.length;)if(s=(i=c.pop())[4],u=i[3],h=i[2],o=i[1],i=i[0],o!=t.length){if(e&&t[o]in e&&((a=e[t[o]].charCodeAt(0))in y&&((l=this.followByte(y[a],s))!=m&&c.push([i+e[t[o]],o+1,h,u,l]))),h<r&&!u){c.push([i,o+1,h+1,u,s]);for(var f=this.guide[s<<1];(l=this.followByte(f,s))!=m&&f in b&&c.push([i+b[f],o,h+1,u,l]),f=this.guide[1+(l<<1)],l!=m;);var g=v[t[o]];if(g)for(var d=0;d<g.length;d++)(a=g.charCodeAt(d))in y&&((l=this.followByte(y[a],s))!=m&&c.push([i+g[d],o+1,h+1,u,l]));o<t.length-1&&((a=t.charCodeAt(o+1))in y&&((l=this.followByte(y[a],s))!=m&&((a=t.charCodeAt(o))in y&&((l=this.followByte(y[a],l))!=m&&c.push([i+t[o+1]+t[o],o+2,h+1,u,l])))))}if((a=t.charCodeAt(o))in y&&(l=this.followByte(y[a],s))!=m)for(c.push([i+t[o],o+1,h,u,l]);u<n&&!h&&o<t.length-1;){if(t[o]==t[o+1])c.push([i+t[o],o+2,h,u+1,l]),o++;else{if(!(o<t.length-2&&"-"==t[o+1]&&t[o]==t[o+2]))break;c.push([i+t[o],o+3,h,u+1,l]),o+=2}u++}}else{if(h<r&&!u)for(f=this.guide[s<<1];(l=this.followByte(f,s))!=m&&f in b&&c.push([i+b[f],o,h+1,u,l]),f=this.guide[1+(l<<1)],l!=m;);if("int"==this.format){this.hasValue(s)&&p.push([i,this.value(s)]);continue}if(("words"==this.format||"probs"==this.format)&&(s=this.followByte(1,s))==m)continue;p.push([i,this.iterateAll(s),u,h])}return p},s}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?(module.exports=module.exports||{})&&(module.exports.Morph=e(module.exports)):"function"==typeof define&&define.amd?define("Az.Morph",["Az","Az.DAWG"],e):(t.Az=t.Az||{})&&(t.Az.Morph=e(t.Az))}(this,function(p){"use strict";function s(n){if("freeze"in Object)return Object.getOwnPropertyNames(n).forEach(function(t){var e=n[t];"object"==typeof e&&null!==e&&s(e)}),Object.freeze(n)}function a(t,e){var n=new N(t);return n.ext=new N(e),s(n)}function h(t,e,n){var r;if("auto"==n.typos){r=t.findAll(e,n.replacements,n.stutter,0);for(var i=0;i<l.length&&!r.length&&e.length>l[i];i++)r=t.findAll(e,n.replacements,n.stutter,i+1)}else r=t.findAll(e,n.replacements,n.stutter,n.typos);return r}function c(t,e){return Math.pow(.3,Math.min(t,1)+e)}var u,f,o,g,d,m,y,k=new Array(3),x=["","по","наи"],b={ignoreCase:!1,replacements:{"е":"ё"},stutter:1/0,typos:0,parsers:["Dictionary?","AbbrName?","AbbrPatronymic","IntNumber","RealNumber","Punctuation","RomanNumber?","Latin","HyphenParticle","HyphenAdverb","HyphenWords","PrefixKnown","PrefixUnknown?","SuffixKnown?","Abbr"],forceParse:!1,normalizeScore:!0},v="АБВГДЕЁЖЗИЙКЛМНОПРСТУФХЦЧШЩЭЮЯ",w=["-то","-ка","-таки","-де","-тко","-тка","-с","-ста"],A=["авиа","авто","аква","анти","анти-","антропо","архи","арт","арт-","астро","аудио","аэро","без","бес","био","вело","взаимо","вне","внутри","видео","вице-","вперед","впереди","гекто","гелио","гео","гетеро","гига","гигро","гипер","гипо","гомо","дву","двух","де","дез","дека","деци","дис","до","евро","за","зоо","интер","инфра","квази","квази-","кило","кино","контр","контр-","космо","космо-","крипто","лейб-","лже","лже-","макро","макси","макси-","мало","меж","медиа","медиа-","мега","мета","мета-","метео","метро","микро","милли","мини","мини-","моно","мото","много","мульти","нано","нарко","не","небез","недо","нейро","нео","низко","обер-","обще","одно","около","орто","палео","пан","пара","пента","пере","пиро","поли","полу","после","пост","пост-","порно","пра","пра-","пред","пресс-","противо","противо-","прото","псевдо","псевдо-","радио","разно","ре","ретро","ретро-","само","санти","сверх","сверх-","спец","суб","супер","супер-","супра","теле","тетра","топ-","транс","транс-","ультра","унтер-","штаб-","экзо","эко","эндо","эконом-","экс","экс-","экстра","экстра-","электро","энерго","этно"],l=[4,9],C=[],T=!1,N=function(t){var e,n=t.split(" ");this.stat=n[0].split(","),this.flex=n[1]?n[1].split(","):[];for(var r=0;r<2;r++)for(var i=this[["stat","flex"][r]],s=0;s<i.length;s++){var o=i[s];for(this[o]=!0;g[o]&&(e=g[o].parent);)this[e]=o,o=e}"POST"in this&&(this.POS=this.POST)};N.prototype.toString=function(){return(this.stat.join(",")+" "+this.flex.join(",")).trim()},N.prototype.matches=function(t,e){if(!e){if("[object Array]"===Object.prototype.toString.call(t)){for(var n=0;n<t.length;n++)if(!this[t[n]])return!1;return!0}for(var r in t)if("[object Array]"===Object.prototype.toString.call(t[r])){if(!t[r].indexOf(this[r]))return!1}else if(t[r]!=this[r])return!1;return!0}t instanceof L&&(t=t.tag);for(n=0;n<e.length;n++)if(t[e[n]]!=this[e[n]])return!1;return!0},N.prototype.isProductive=function(){return!(this.NUMR||this.NPRO||this.PRED||this.PREP||this.CONJ||this.PRCL||this.INTJ||this.Apro||this.NUMB||this.ROMN||this.LATN||this.PNCT||this.UNKN)},N.prototype.isCapitalized=function(){return this.Name||this.Surn||this.Patr||this.Geox||this.Init};var P=function(t,e){if(!T)throw new Error("Please call Az.Morph.init() before using this module.");e=e?p.extend(b,e):b;for(var n=[],r=!1,i=0;i<e.parsers.length;i++){var s=e.parsers[i],o="?"!=s[s.length-1];if((s=o?s:s.slice(0,-1))in P.Parsers){for(var a=P.Parsers[s](t,e),l=0;l<a.length;l++)a[l].parser=s,a[l].stutterCnt||a[l].typosCnt||(r=!0);if(n=n.concat(a),r&&o)break}else console.warn('Parser "'+s+'" is not found. Skipping')}!n.length&&e.forceParse&&n.push(new L(t.toLocaleLowerCase(),y));var h=0;for(i=0;i<n.length;i++)if("Dictionary"==n[i].parser){var u=f.findAll(n[i]+":"+n[i].tag);u&&u[0]&&(n[i].score=u[0][1]/1e6*c(n[i].stutterCnt,n[i].typosCnt),h+=n[i].score)}if(e.normalizeScore){if(0<h)for(i=0;i<n.length;i++)"Dictionary"==n[i].parser&&(n[i].score/=h);for(i=h=0;i<n.length;i++)"Dictionary"!=n[i].parser&&(h+=n[i].score);if(0<h)for(i=0;i<n.length;i++)"Dictionary"!=n[i].parser&&(n[i].score/=h)}return n.sort(function(t,e){return e.score-t.score}),n};P.Parsers={};var L=function(t,e,n,r,i){this.word=t,this.tag=e,this.stutterCnt=r||0,this.typosCnt=i||0,this.score=n||0};L.prototype.normalize=function(t){return this.inflect(t?{POS:this.tag.POS}:0)},L.prototype.inflect=function(t,e){return this},L.prototype.pluralize=function(t){return this.tag.NOUN||this.tag.ADJF||this.tag.PRTF?("number"==typeof t&&(t=(t%=100)%10==0||4<t%10||4<t&&t<21?"many":t%10==1?"one":"few"),!this.tag.NOUN||this.tag.nomn||this.tag.accs?"one"==t?this.inflect(["sing",this.tag.nomn?"nomn":"accs"]):this.tag.NOUN&&"few"==t?this.inflect(["sing","gent"]):(this.tag.ADJF||this.tag.PRTF)&&this.tag.femn&&"few"==t?this.inflect(["plur","nomn"]):this.inflect(["plur","gent"]):this.inflect(["one"==t?"sing":"plur",this.tag.CAse])):this},L.prototype.matches=function(t,e){return this.tag.matches(t,e)},L.prototype.toString=function(){return this.word},L.prototype.log=function(){console.group(this.toString()),console.log("Stutter?",this.stutterCnt,"Typos?",this.typosCnt),console.log(this.tag.ext.toString()),console.groupEnd()};function S(t,e,n,r,i,s,o){this.word=t,this.paradigmIdx=e,this.paradigm=d[e],this.formIdx=n,this.formCnt=this.paradigm.length/3,this.tag=m[this.paradigm[this.formCnt+n]],this.stutterCnt=r||0,this.typosCnt=i||0,this.score=c(this.stutterCnt,this.typosCnt),this.prefix=s||"",this.suffix=o||""}((S.prototype=Object.create(L.prototype)).constructor=S).prototype.base=function(){return this._base?this._base:this._base=this.word.substring(x[this.paradigm[(this.formCnt<<1)+this.formIdx]].length,this.word.length-o[this.paradigm[this.formIdx]].length)},S.prototype.inflect=function(t,e){if(!e&&"number"==typeof t)return new S(x[this.paradigm[(this.formCnt<<1)+t]]+this.base()+o[this.paradigm[t]],this.paradigmIdx,t,0,0,this.prefix,this.suffix);for(var n=0;n<this.formCnt;n++)if(m[this.paradigm[this.formCnt+n]].matches(t,e))return new S(x[this.paradigm[(this.formCnt<<1)+n]]+this.base()+o[this.paradigm[n]],this.paradigmIdx,n,0,0,this.prefix,this.suffix);return!1},S.prototype.log=function(){console.group(this.toString()),console.log("Stutter?",this.stutterCnt,"Typos?",this.typosCnt),console.log(x[this.paradigm[(this.formCnt<<1)+this.formIdx]]+"|"+this.base()+"|"+o[this.paradigm[this.formIdx]]),console.log(this.tag.ext.toString());var t=this.normalize();console.log("=> ",t+" ("+t.tag.ext.toString()+")"),t=this.normalize(!0),console.log("=> ",t+" ("+t.tag.ext.toString()+")"),console.groupCollapsed("Все формы: "+this.formCnt);for(var e=0;e<this.formCnt;e++){var n=this.inflect(e);console.log(n+" ("+n.tag.ext.toString()+")")}console.groupEnd(),console.groupEnd()},S.prototype.toString=function(){if(this.prefix){var t=x[this.paradigm[(this.formCnt<<1)+this.formIdx]];return t+this.prefix+this.word.substr(t.length)+this.suffix}return this.word+this.suffix};function I(t,e){this.left=t,this.right=e,this.tag=e.tag,this.score=t.score*e.score*.8,this.stutterCnt=t.stutterCnt+e.stutterCnt,this.typosCnt=t.typosCnt+e.typosCnt,"formCnt"in e&&(this.formCnt=e.formCnt)}return((I.prototype=Object.create(L.prototype)).constructor=I).prototype.inflect=function(t,e){var n,r=this.right.inflect(t,e);return!(!(n=e||"number"!=typeof t?this.left.inflect(t,e):this.left.inflect(r.tag,["POST","NMbr","CAse","PErs","TEns"]))||!r)&&new I(n,r)},I.prototype.toString=function(){return this.left.word+"-"+this.right.word},C.push(function(){P.Parsers.Dictionary=function(t,e){var n=!e.ignoreCase&&t.length&&t[0].toLocaleLowerCase()!=t[0]&&t.substr(1).toLocaleUpperCase()!=t.substr(1);t=t.toLocaleLowerCase();for(var r=h(u,t,e),i=[],s=0;s<r.length;s++)for(var o=0;o<r[s][1].length;o++){var a=new S(r[s][0],r[s][1][o][0],r[s][1][o][1],r[s][2],r[s][3]);!e.ignoreCase&&a.tag.isCapitalized()&&!n||i.push(a)}return i};for(var o=[],t=0;t<=2;t++)for(var e=0;e<=5;e++)for(var n=0;n<=1;n++)o.push(a("NOUN,inan,"+["masc","femn","neut"][t]+",Fixd,Abbr "+["sing","plur"][n]+","+["nomn","gent","datv","accs","ablt","loct"][e],"СУЩ,неод,"+["мр","жр","ср"][t]+",0,аббр "+["ед","мн"][n]+","+["им","рд","дт","вн","тв","пр"][e]));P.Parsers.Abbr=function(t,e){if(t.length<2)return[];if(-1<t.indexOf("-"))return[];if(-1<v.indexOf(t[0])&&-1<v.indexOf(t[t.length-1])){for(var n=0,r=0;r<t.length;r++)-1<v.indexOf(t[r])&&n++;if(n<=5){var i=[];for(r=0;r<o.length;r++){var s=new L(t,o[r],.5);i.push(s)}return i}}if(!e.ignoreCase||5<t.length)return[];t=t.toLocaleUpperCase();for(r=0;r<t.length;r++)if(-1==v.indexOf(t[r]))return[];for(i=[],r=0;r<o.length;r++){s=new L(t,o[r],.2);i.push(s)}return i};function r(t,s){for(var o=[],e=0;e<=1;e++)for(var n=0;n<=5;n++)o.push(a("NOUN,anim,"+["masc","femn"][e]+",Sgtm,Name,Fixd,Abbr,Init sing,"+["nomn","gent","datv","accs","ablt","loct"][n],"СУЩ,од,"+["мр","жр"][e]+",sg,имя,0,аббр,иниц ед,"+["им","рд","дт","вн","тв","пр"][n]));return function(t,e){if(1!=t.length)return[];if(e.ignoreCase&&(t=t.toLocaleUpperCase()),-1==v.indexOf(t))return[];for(var n=[],r=0;r<o.length;r++){var i=new L(t,o[r],s);n.push(i)}return n}}P.Parsers.AbbrName=r(0,.1),P.Parsers.AbbrPatronymic=r(0,.1);function i(n,r,t){return function(t,e){return e.ignoreCase&&(t=t.toLocaleUpperCase()),t.length&&t.match(n)?[new L(t,r)]:[]}}g.NUMB=g["ЧИСЛО"]=g.ROMN=g["РИМ"]=g.LATN=g["ЛАТ"]=g.PNCT=g["ЗПР"]=g.UNKN=g["НЕИЗВ"]={parent:"POST"},P.Parsers.IntNumber=i(/^[−-]?[0-9]+$/,a("NUMB,intg","ЧИСЛО,цел")),P.Parsers.RealNumber=i(/^[−-]?([0-9]*[.,][0-9]+)$/,a("NUMB,real","ЧИСЛО,вещ")),P.Parsers.Punctuation=i(/^[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,\-.\/:;<=>?@\[\]^_`{|}~]+$/,a("PNCT","ЗПР")),P.Parsers.RomanNumber=i(/^M{0,4}(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3})$/,a("ROMN","РИМ")),P.Parsers.Latin=i(/[A-Za-z\u00C0-\u00D6\u00D8-\u00f6\u00f8-\u024f]$/,a("LATN","ЛАТ")),P.Parsers.HyphenParticle=function(t,e){t=t.toLocaleLowerCase();for(var n=[],r=0;r<w.length;r++)if(t.substr(t.length-w[r].length)==w[r])for(var i=t.slice(0,-w[r].length),s=h(u,i,e),o=0;o<s.length;o++)for(var a=0;a<s[o][1].length;a++){var l=new S(s[o][0],s[o][1][a][0],s[o][1][a][1],s[o][2],s[o][3],"",w[r]);l.score*=.9,n.push(l)}return n};var l=a("ADVB","Н");P.Parsers.HyphenAdverb=function(t,e){if((t=t.toLocaleLowerCase()).length<5||"по-"!=t.substr(0,3))return[];for(var n=h(u,t.substr(3),e),r=[],i={},s=0;s<n.length;s++)if(!i[n[s][0]])for(var o=0;o<n[s][1].length;o++){var a=new S(n[s][0],n[s][1][o][0],n[s][1][o][1],n[s][2],n[s][3]);if(a.matches(["ADJF","sing","datv"])){i[n[s][0]]=!0,a=new L("по-"+n[s][0],l,.9*a.score,n[s][2],n[s][3]),r.push(a);break}}return r},P.Parsers.HyphenWords=function(t,e){t=t.toLocaleLowerCase();for(var n=0;n<A.length;n++)if("-"==A[n][A[n].length-1]&&t.substr(0,A[n].length)==A[n])return[];var r=[],i=t.split("-");if(2!=i.length||!i[0].length||!i[1].length){if(2<i.length)for(var s=i[i.length-1],o=P.Parsers.Dictionary(s,e),a=0;a<o.length;a++)o[a]instanceof S&&(o[a].score*=.2,o[a].prefix=t.substr(0,t.length-s.length-1)+"-",r.push(o[a]));return r}var l=P.Parsers.Dictionary(i[0],e);for(o=P.Parsers.Dictionary(i[1],e),n=0;n<l.length;n++)if(!l[n].tag.Abbr)for(a=0;a<o.length;a++)l[n].matches(o[a],["POST","NMbr","CAse","PErs","TEns"])&&(l[n].stutterCnt+o[a].stutterCnt>e.stutter||l[n].typosCnt+o[a].typosCnt>e.typos||r.push(new I(l[n],o[a])));for(a=0;a<o.length;a++)o[a]instanceof S&&(o[a].score*=.3,o[a].prefix=i[0]+"-",r.push(o[a]));return r},P.Parsers.PrefixKnown=function(t,e){var n=!e.ignoreCase&&t.length&&t[0].toLocaleLowerCase()!=t[0]&&t.substr(1).toLocaleUpperCase()!=t.substr(1);t=t.toLocaleLowerCase();for(var r=[],i=0;i<A.length;i++)if(!(t.length-A[i].length<3)&&t.substr(0,A[i].length)==A[i])for(var s=t.substr(A[i].length),o=P.Parsers.Dictionary(s,e),a=0;a<o.length;a++)o[a].tag.isProductive()&&(e.ignoreCase||!o[a].tag.isCapitalized()||n)&&(o[a].score*=.7,o[a].prefix=A[i],r.push(o[a]));return r},P.Parsers.PrefixUnknown=function(t,e){var n=!e.ignoreCase&&t.length&&t[0].toLocaleLowerCase()!=t[0]&&t.substr(1).toLocaleUpperCase()!=t.substr(1);t=t.toLocaleLowerCase();for(var r=[],i=1;i<=5&&!(t.length-i<3);i++)for(var s=t.substr(i),o=P.Parsers.Dictionary(s,e),a=0;a<o.length;a++)o[a].tag.isProductive()&&(e.ignoreCase||!o[a].tag.isCapitalized()||n)&&(o[a].score*=.3,o[a].prefix=t.substr(0,i),r.push(o[a]));return r},P.Parsers.SuffixKnown=function(t,e){if(t.length<4)return[];var n=!e.ignoreCase&&t.length&&t[0].toLocaleLowerCase()!=t[0]&&t.substr(1).toLocaleUpperCase()!=t.substr(1);t=t.toLocaleLowerCase();for(var r=[],i=1,s=[0,.2,.3,.4,.5,.6],o={},a=0;a<x.length;a++)if(!x[a].length||t.substr(0,x[a].length)==x[a])for(var l=t.substr(x[a].length),h=5;i<=h;h--)if(!(h>=l.length)){var u=l.substr(0,l.length-h),p=l.substr(l.length-h),c=k[a].findAll(p,e.replacements,0,0);if(c){for(var f=[],g=1,d=0;d<c.length;d++)for(var m=c[d][0],y=c[d][1],b=0;b<y.length;b++){var v=new S(x[a]+u+m,y[b][1],y[b][2]);if(v.tag.isProductive()&&(e.ignoreCase||!v.tag.isCapitalized()||n)){var w=v.toString()+":"+y[b][1]+":"+y[b][2];w in o||(g=Math.max(g,y[b][0]),v.score=y[b][0]*s[h],f.push(v),o[w]=!0)}}if(0<f.length){for(d=0;d<f.length;d++)f[d].score/=g;r=r.concat(f),i=Math.max(h-1,1)}}}return r},y=a("UNKN","НЕИЗВ")}),P.setDefaults=function(t){b=t},P.init=function(t,a){function l(){if(!--e){m=Array(n.length);for(var t=0;t<n.length;t++)m[t]=new N(n[t]),m[t].ext=new N(r[t]);m=s(m);for(t=0;t<C.length;t++)C[t]();T=!0,a&&a(null,P)}}var n,r,e=0;a||"function"!=typeof t||(a=t,t="string"==typeof __dirname?__dirname+"/../dicts":"dicts"),e++,p.DAWG.load(t+"/words.dawg","words",function(t,e){return t?void a(t):(u=e,void l())});for(var i=0;i<3;i++)!function(n){e++,p.DAWG.load(t+"/prediction-suffixes-"+n+".dawg","probs",function(t,e){return t?void a(t):(k[n]=e,void l())})}(i);e++,p.DAWG.load(t+"/p_t_given_w.intdawg","int",function(t,e){return t?void a(t):(f=e,void l())}),e++,p.load(t+"/grammemes.json","json",function(t,e){if(t)a(t);else{g={};for(var n=0;n<e.length;n++)g[e[n][0]]=g[e[n][2]]={parent:e[n][1],internal:e[n][0],external:e[n][2],externalFull:e[n][3]};l()}}),e++,p.load(t+"/gramtab-opencorpora-int.json","json",function(t,e){return t?void a(t):(n=e,void l())}),e++,p.load(t+"/gramtab-opencorpora-ext.json","json",function(t,e){return t?void a(t):(r=e,void l())}),e++,p.load(t+"/suffixes.json","json",function(t,e){return t?void a(t):(o=e,void l())}),e++,p.load(t+"/paradigms.array","arraybuffer",function(t,e){if(t)a(t);else{var n=new Uint16Array(e),r=n[0],i=1;d=[];for(var s=0;s<r;s++){var o=n[i++];d.push(n.subarray(i,i+o)),i+=o}l()}})},P}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?(module.exports=module.exports||{})&&(module.exports.Syntax=e(module.exports)):"function"==typeof define&&define.amd?define("Az.Syntax",["Az"],e):(t.Az=t.Az||{})&&(t.Az.Syntax=e(t.Az))}(this,function(t){"use strict";return function(){}}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?(module.exports=module.exports||{})&&(module.exports.Tokens=e()):"function"==typeof define&&define.amd?define("Az.Tokens",["Az"],e):(t.Az=t.Az||{})&&(t.Az.Tokens=e())}(this,function(){"use strict";function s(t,i){if(!t)return!0;if("function"==typeof t)return t;var s,o=t;if("length"in t){s=!i,o={};for(var e=0;e<t.length;e++)o[t[e]]=!0}else s=i,i=!1;return function(t,e,n){if(t.subType){var r=t.type+"."+t.subType;if(r in o)return o[r]!=i}return t.type in o?o[t.type]!=i:!s}}for(var t="ac|ad|ae|aero|af|ag|ai|al|am|ao|aq|ar|arpa|as|asia|at|au|aw|ax|az|ba|bb|be|bf|bg|bh|bi|biz|bj|bm|bo|br|bs|bt|bv|bw|by|bz|ca|cat|cc|cd|cf|cg|ch|ci|cl|cm|cn|co|com|coop|cr|cu|cv|cw|cx|cz|de|dj|dk|dm|do|dz|ec|edu|ee|eg|es|et|eu|fi|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gov|gp|gq|gr|gs|gt|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|info|int|io|iq|ir|is|it|je|jo|jobs|jp|kg|ki|km|kn|kp|kr|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mil|mk|ml|mn|mo|mobi|mp|mq|mr|ms|mt|mu|museum|mv|mw|mx|my|na|name|nc|ne|net|nf|ng|nl|no|nr|nu|nz|om|org|pa|pe|pf|ph|pk|pl|pm|pn|post|pr|pro|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sx|sy|sz|tc|td|tel|tf|tg|th|tj|tk|tl|tm|tn|to|tr|travel|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|yt|امارات|հայ|বাংলা|бел|中国|中國|الجزائر|مصر|ею|გე|ελ|香港|भारत|بھارت|భారత్|ભારત|ਭਾਰਤ|ভারত|இந்தியா|ایران|ايران|عراق|الاردن|한국|қаз|ලංකා|இலங்கை|المغرب|мкд|мон|澳門|澳门|مليسيا|عمان|پاکستان|پاكستان|فلسطين|срб|рф|قطر|السعودية|السعودیة|السعودیۃ|السعوديه|سودان|新加坡|சிங்கப்பூர்|سورية|سوريا|ไทย|تونس|台灣|台湾|臺灣|укр|اليمن|xxx|zm|aaa|aarp|abarth|abb|abbott|abbvie|abc|able|abogado|abudhabi|academy|accenture|accountant|accountants|aco|active|actor|adac|ads|adult|aeg|aetna|afamilycompany|afl|africa|africamagic|agakhan|agency|aig|aigo|airbus|airforce|airtel|akdn|alfaromeo|alibaba|alipay|allfinanz|allstate|ally|alsace|alstom|americanexpress|americanfamily|amex|amfam|amica|amsterdam|analytics|android|anquan|anz|aol|apartments|app|apple|aquarelle|arab|aramco|archi|army|art|arte|asda|associates|athleta|attorney|auction|audi|audible|audio|auspost|author|auto|autos|avianca|aws|axa|azure|baby|baidu|banamex|bananarepublic|band|bank|bar|barcelona|barclaycard|barclays|barefoot|bargains|baseball|basketball|bauhaus|bayern|bbc|bbt|bbva|bcg|bcn|beats|beauty|beer|bentley|berlin|best|bestbuy|bet|bharti|bible|bid|bike|bing|bingo|bio|black|blackfriday|blanco|blockbuster|blog|bloomberg|blue|bms|bmw|bnl|bnpparibas|boats|boehringer|bofa|bom|bond|boo|book|booking|boots|bosch|bostik|boston|bot|boutique|box|bradesco|bridgestone|broadway|broker|brother|brussels|budapest|bugatti|build|builders|business|buy|buzz|bzh|cab|cafe|cal|call|calvinklein|camera|camp|cancerresearch|canon|capetown|capital|capitalone|car|caravan|cards|care|career|careers|cars|cartier|casa|case|caseih|cash|casino|catering|catholic|cba|cbn|cbre|cbs|ceb|center|ceo|cern|cfa|cfd|chanel|channel|chase|chat|cheap|chintai|chloe|christmas|chrome|chrysler|church|cipriani|circle|cisco|citadel|citi|citic|city|cityeats|claims|cleaning|click|clinic|clinique|clothing|cloud|club|clubmed|coach|codes|coffee|college|cologne|comcast|commbank|community|company|compare|computer|comsec|condos|construction|consulting|contact|contractors|cooking|cookingchannel|cool|corsica|country|coupon|coupons|courses|credit|creditcard|creditunion|cricket|crown|crs|cruise|cruises|csc|cuisinella|cymru|cyou|dabur|dad|dance|date|dating|datsun|day|dclk|dds|deal|dealer|deals|degree|delivery|dell|deloitte|delta|democrat|dental|dentist|desi|design|dev|dhl|diamonds|diet|digital|direct|directory|discount|discover|dish|diy|dnp|docs|dodge|dog|doha|domains|dot|download|drive|dstv|dtv|dubai|duck|dunlop|duns|dupont|durban|dvag|dwg|earth|eat|edeka|education|email|emerck|emerson|energy|engineer|engineering|enterprises|epost|epson|equipment|ericsson|erni|esq|estate|esurance|etisalat|eurovision|eus|events|everbank|exchange|expert|exposed|express|extraspace|fage|fail|fairwinds|faith|family|fan|fans|farm|farmers|fashion|fast|fedex|feedback|ferrari|ferrero|fiat|fidelity|fido|film|final|finance|financial|fire|firestone|firmdale|fish|fishing|fit|fitness|flickr|flights|flir|florist|flowers|flsmidth|fly|foo|foodnetwork|football|ford|forex|forsale|forum|foundation|fox|free|fresenius|frl|frogans|frontdoor|frontier|ftr|fujitsu|fujixerox|fun|fund|furniture|futbol|fyi|gal|gallery|gallo|gallup|game|games|gap|garden|gbiz|gdn|gea|gent|genting|george|ggee|gift|gifts|gives|giving|glade|glass|gle|global|globo|gmail|gmbh|gmo|gmx|godaddy|gold|goldpoint|golf|goo|goodhands|goodyear|goog|google|gop|got|gotv|grainger|graphics|gratis|green|gripe|group|guardian|gucci|guge|guide|guitars|guru|hair|hamburg|hangout|haus|hbo|hdfc|hdfcbank|health|healthcare|help|helsinki|here|hermes|hgtv|hiphop|hisamitsu|hitachi|hiv|hkt|hockey|holdings|holiday|homedepot|homegoods|homes|homesense|honda|honeywell|horse|host|hosting|hot|hoteles|hotmail|house|how|hsbc|htc|hughes|hyatt|hyundai|ibm|icbc|ice|icu|ieee|ifm|iinet|ikano|imamat|imdb|immo|immobilien|industries|infiniti|ing|ink|institute|insurance|insure|intel|international|intuit|investments|ipiranga|irish|iselect|ismaili|ist|istanbul|itau|itv|iveco|iwc|jaguar|java|jcb|jcp|jeep|jetzt|jewelry|jio|jlc|jll|jmp|jnj|joburg|jot|joy|jpmorgan|jprs|juegos|juniper|kaufen|kddi|kerryhotels|kerrylogistics|kerryproperties|kfh|kia|kim|kinder|kindle|kitchen|kiwi|koeln|komatsu|kosher|kpmg|kpn|krd|kred|kuokgroup|kyknet|kyoto|lacaixa|ladbrokes|lamborghini|lamer|lancaster|lancia|lancome|land|landrover|lanxess|lasalle|lat|latino|latrobe|law|lawyer|lds|lease|leclerc|lefrak|legal|lego|lexus|lgbt|liaison|lidl|life|lifeinsurance|lifestyle|lighting|like|lilly|limited|limo|lincoln|linde|link|lipsy|live|living|lixil|loan|loans|locker|locus|loft|lol|london|lotte|lotto|love|lpl|lplfinancial|ltd|ltda|lundbeck|lupin|luxe|luxury|macys|madrid|maif|maison|makeup|man|management|mango|market|marketing|markets|marriott|marshalls|maserati|mattel|mba|mcd|mcdonalds|mckinsey|med|media|meet|melbourne|meme|memorial|men|menu|meo|metlife|miami|microsoft|mini|mint|mit|mitsubishi|mlb|mls|mma|mnet|mobily|moda|moe|moi|mom|monash|money|monster|montblanc|mopar|mormon|mortgage|moscow|moto|motorcycles|mov|movie|movistar|msd|mtn|mtpc|mtr|multichoice|mutual|mutuelle|mzansimagic|nab|nadex|nagoya|naspers|nationwide|natura|navy|nba|nec|netbank|netflix|network|neustar|new|newholland|news|next|nextdirect|nexus|nfl|ngo|nhk|nico|nike|nikon|ninja|nissan|nissay|nokia|northwesternmutual|norton|now|nowruz|nowtv|nra|nrw|ntt|nyc|obi|observer|off|office|okinawa|olayan|olayangroup|oldnavy|ollo|omega|one|ong|onl|online|onyourside|ooo|open|oracle|orange|organic|orientexpress|origins|osaka|otsuka|ott|ovh|page|pamperedchef|panasonic|panerai|paris|pars|partners|parts|party|passagens|pay|payu|pccw|pet|pfizer|pharmacy|philips|photo|photography|photos|physio|piaget|pics|pictet|pictures|pid|pin|ping|pink|pioneer|pizza|place|play|playstation|plumbing|plus|pnc|pohl|poker|politie|porn|pramerica|praxi|press|prime|prod|productions|prof|progressive|promo|properties|property|protection|pru|prudential|pub|pwc|qpon|quebec|quest|qvc|racing|raid|read|realestate|realtor|realty|recipes|red|redstone|redumbrella|rehab|reise|reisen|reit|reliance|ren|rent|rentals|repair|report|republican|rest|restaurant|review|reviews|rexroth|rich|richardli|ricoh|rightathome|ril|rio|rip|rmit|rocher|rocks|rodeo|rogers|room|rsvp|ruhr|run|rwe|ryukyu|saarland|safe|safety|sakura|sale|salon|samsclub|samsung|sandvik|sandvikcoromant|sanofi|sap|sapo|sarl|sas|save|saxo|sbi|sbs|sca|scb|schaeffler|schmidt|scholarships|school|schule|schwarz|science|scjohnson|scor|scot|seat|secure|security|seek|select|sener|services|ses|seven|sew|sex|sexy|sfr|shangrila|sharp|shaw|shell|shia|shiksha|shoes|shopping|shouji|show|showtime|shriram|silk|sina|singles|site|ski|skin|sky|skype|sling|smart|smile|sncf|soccer|social|softbank|software|sohu|solar|solutions|song|sony|soy|space|spiegel|spot|spreadbetting|srl|srt|stada|staples|star|starhub|statebank|statefarm|statoil|stc|stcgroup|stockholm|storage|store|stream|studio|study|style|sucks|supersport|supplies|supply|support|surf|surgery|suzuki|swatch|swiftcover|swiss|sydney|symantec|systems|tab|taipei|talk|taobao|target|tatamotors|tatar|tattoo|tax|taxi|tci|tdk|team|tech|technology|telecity|telefonica|temasek|tennis|teva|thd|theater|theatre|theguardian|tiaa|tickets|tienda|tiffany|tips|tires|tirol|tjmaxx|tjx|tkmaxx|tmall|today|tokyo|tools|top|toray|toshiba|total|tours|town|toyota|toys|trade|trading|training|travelchannel|travelers|travelersinsurance|trust|trv|tube|tui|tunes|tushu|tvs|ubank|ubs|uconnect|unicom|university|uno|uol|ups|vacations|vana|vanguard|vegas|ventures|verisign|versicherung|vet|viajes|video|vig|viking|villas|vin|vip|virgin|visa|vision|vista|vistaprint|viva|vivo|vlaanderen|vodka|volkswagen|volvo|vote|voting|voto|voyage|vuelos|wales|walmart|walter|wang|wanggou|warman|watch|watches|weather|weatherchannel|webcam|weber|website|wed|wedding|weibo|weir|whoswho|wien|wiki|williamhill|win|windows|wine|winners|wme|wolterskluwer|woodside|work|works|world|wow|wtc|wtf|xbox|xerox|xfinity|xihuan|xin|कॉम|セール|佛山|慈善|集团|在线|大众汽车|点看|คอม|八卦|موقع|一号店|公益|公司|香格里拉|网站|移动|我爱你|москва|католик|онлайн|сайт|联通|קום|时尚|微博|淡马锡|ファッション|орг|नेट|ストア|삼성|商标|商店|商城|дети|ポイント|新闻|工行|家電|كوم|中文网|中信|娱乐|谷歌|電訊盈科|购物|クラウド|通販|网店|संगठन|餐厅|网络|ком|诺基亚|食品|飞利浦|手表|手机|ارامكو|العليان|اتصالات|بازار|موبايلي|ابوظبي|كاثوليك|همراه|닷컴|政府|شبكة|بيتك|عرب|机构|组织机构|健康|рус|珠宝|大拿|みんな|グーグル|世界|書籍|网址|닷넷|コム|天主教|游戏|vermögensberater|vermögensberatung|企业|信息|嘉里大酒店|嘉里|广东|政务|xperia|xyz|yachts|yahoo|yamaxun|yandex|yodobashi|yoga|yokohama|you|youtube|yun|zappos|zara|zero|zip|zippo|zone|zuerich".split("|"),w={html:!1,wiki:!1,markdown:!1,hashtags:!0,mentions:!0,emails:!0,links:{protocols:!0,www:!1,tlds:{}}},k={nbsp:" ",quot:'"',gt:">",lt:"<",amp:"&",ndash:"–"},e=0;e<t.length;e++)w.links.tlds[t[e]]=!0;function x(t,e,n,r,i,s,o,a){this.source=t,this.st=e,this.length=n,this.index=r,this.firstUpper=i,this.allUpper=s,this.type=o,a&&(this.subType=a)}x.prototype.toString=function(){return"_str"in this&&this._str.length==this.length?this._str:this._str=this.source.substr(this.st,this.length)},x.prototype.indexOf=function(t){if(1!=t.length)return this.toString().indexOf(t);for(var e=0;e<this.length;e++)if(this.source[this.st+e]==t)return e;return-1},x.prototype.toLowerCase=function(){return this.toString().toLocaleLowerCase()},x.prototype.isCapitalized=function(){return this.firstUpper&&!this.allUpper},x.prototype.en=function(){return this.st+this.length-1};var A=function(t,e){return this instanceof A?(this.tokens=[],this.source="","string"==typeof t?(this.config=e?Az.extend(w,e):w,this.append(t)):this.config=t?Az.extend(w,t):w,void(this.index=-1)):new A(t,e)};return A.WORD=new String("WORD"),A.NUMBER=new String("NUMBER"),A.OTHER=new String("OTHER"),A.DIGIT=new String("DIGIT"),A.CYRIL=new String("CYRIL"),A.LATIN=new String("LATIN"),A.MIXED=new String("MIXED"),A.PUNCT=new String("PUNCT"),A.SPACE=new String("SPACE"),A.MARKUP=new String("MARKUP"),A.NEWLINE=new String("NEWLINE"),A.EMAIL=new String("EMAIL"),A.LINK=new String("LINK"),A.HASHTAG=new String("HASHTAG"),A.MENTION=new String("MENTION"),A.TAG=new String("TAG"),A.CONTENT=new String("CONTENT"),A.SCRIPT=new String("SCRIPT"),A.STYLE=new String("STYLE"),A.COMMENT=new String("COMMENT"),A.CLOSING=new String("CLOSING"),A.TEMPLATE=new String("TEMPLATE"),A.RANGE=new String("RANGE"),A.ENTITY=new String("ENTITY"),A.prototype.append=function(t,e){(e=e?Az.extend(this.config,e):this.config).links&&!0===e.links.tlds&&(e.links.tlds=w.links.tlds);var n=this.source.length;this.source+=t;for(var r=this.source,i=this.tokens,s=n;s<r.length;s++){var o=r[s],a=r.charCodeAt(s),l=!1,h=i.length-1,u=i[h],p=s;if(e.html&&";"==o)if(0<h&&u.type===A.WORD&&1==i[h-1].length&&"&"==r[i[h-1].st]){var c=u.toLowerCase();c in k&&(a=(o=k[c]).charCodeAt(0),u=i[h-=2],i.length=h+1)}else 1<h&&(u.type===A.NUMBER||u.type===A.WORD&&"x"==r[u.st])&&1==i[h-1].length&&"#"==r[i[h-1].st]&&1==i[h-1].length&&"&"==r[i[h-1].st]&&(a="x"==r[u.st]?parseInt(u.toString().substr(1),16):parseInt(u.toString(),10),o=String.fromCharCode(a),u=i[h-=3],i.length=h+1);var f=A.OTHER,g=o.toLocaleLowerCase()!=o;1024<=a&&a<=1279&&(f=A.CYRIL),(65<=a&&a<=90||97<=a&&a<=122||192<=a&&a<=591)&&(f=A.LATIN),48<=a&&a<=57&&(f=A.DIGIT),(a<=32||128<=a&&a<=160)&&(f=A.SPACE),-1<"‐-−‒–—―.…,:;?!¿¡()[]«»\"'’‘’“”/⁄".indexOf(o)&&(f=A.PUNCT);var d=f,m=!1;f===A.CYRIL||f===A.LATIN?(d=A.WORD,m=f):f===A.DIGIT&&(d=A.NUMBER);var y=!u||"\n"==r[u.st+u.length-1];if(e.wiki&&(y&&-1<":;*#~|".indexOf(o)&&(d=A.MARKUP,m=A.NEWLINE),-1<"={[|]}".indexOf(o)&&(d=A.MARKUP)),e.markdown&&(y&&-1<"=-#>+-".indexOf(o)&&(d=A.MARKUP,m=A.NEWLINE),-1<"[]*~_`\\".indexOf(o)&&(d=A.MARKUP)),u)if(e.wiki&&"'"!=o&&1==u.length&&"'"==r[u.st]&&0<h&&i[h-1].type===A.WORD&&i[h-1].subType===A.LATIN&&(i[h-1].length+=u.length,h-=1,i.length=h+1,u=i[h]),e.links&&e.links.tlds&&(f===A.PUNCT||f===A.SPACE)&&2<i.length&&i[h-2].type===A.WORD&&1==i[h-1].length&&"."==r[i[h-1].st]&&i[h].type===A.WORD&&u.toString()in e.links.tlds){for(;2<=h&&i[h-2].type===A.WORD&&1==i[h-1].length&&("."==r[i[h-1].st]||"@"==r[i[h-1].st]||":"==r[i[h-1].st]);)(u=i[h-=2]).length+=i[h+1].length+i[h+2].length,u.allUpper=u.allUpper&&i[h+1].allUpper&&i[h+2].allUpper;e.emails&&-1<u.indexOf("@")&&-1==u.indexOf(":")?u.type=A.EMAIL:(u.type=A.LINK,"/"==o&&(l=!0)),i.length=h+1}else if(u.type===A.LINK)")"==o&&1<=h&&i[h-1].type===A.MARKUP&&1==i[h-1].length&&"("==r[i[h-1].st]?d=A.MARKUP:f!==A.SPACE&&","!=o&&"<"!=o&&(l=!0);else if(u.type===A.EMAIL)f!==A.CYRIL&&f!==A.LATIN&&"."!=o||(l=!0);else if(u.type===A.HASHTAG||u.type===A.MENTION)(f===A.CYRIL||f==A.LATIN||f==A.DIGIT||"_"==o||"@"==o&&-1==u.indexOf("@"))&&(l=!0);else if(u.type!==A.TAG||!u.quote&&">"==r[u.en()])if(u.type===A.CONTENT)l=!0,u.quote?o==u.quote&&"\\"!=r[u.en()]&&delete u.quote:'"'==o||"'"==o?u.quote=o:">"==o&&(8<=u.length&&"</script"==u.toString().substr(-8)?(u.length-=8,p-=8,l=!1,d=A.TAG,m=A.CLOSING):7<=u.length&&"</style"==u.toString().substr(-7)&&(u.length-=7,p-=7,l=!1,d=A.TAG,m=A.CLOSING));else if(u.type===A.TAG&&u.type!==A.CLOSING&&8<=u.length&&"script"==u.toLowerCase().substr(1,6))d=A.CONTENT,m=A.SCRIPT;else if(u.type===A.TAG&&u.type!==A.CLOSING&&7<=u.length&&"style"==u.toLowerCase().substr(1,5))d=A.CONTENT,m=A.STYLE;else if(!e.html||1!=u.length||"<"!=r[u.st]||f!==A.LATIN&&"!"!=o&&"/"!=o)if(u.type===A.CONTENT)l=!0;else if(u.type!==A.MARKUP||u.subType!=A.TEMPLATE||"}"==r[u.en()]&&"}"==r[u.en()-1]){if(u.type===A.MARKUP&&u.type===A.LINK&&")"!=r[u.en()])l=!0;else if(u.type===A.MARKUP&&"`"==r[u.st]&&u.subType===A.NEWLINE&&f===A.LATIN)l=!0;else if(f===A.CYRIL||f===A.LATIN)u.type===A.WORD?(l=!0,u.subType=u.subType==f?u.subType:A.MIXED):u.type===A.NUMBER?(l=!0,u.subType=u.subType&&u.subType!=f?A.MIXED:f):e.hashtags&&1==u.length&&"#"==r[u.st]?(l=!0,u.type=A.HASHTAG):!e.mentions||1!=u.length||"@"!=r[u.st]||0!=h&&i[h-1].type!==A.SPACE?f!==A.LATIN||1!=u.length||"'"!=r[u.st]&&"’"!=r[u.st]?1==u.length&&"-"==r[u.st]&&(l=!0,0<h&&i[h-1].type===A.NUMBER&&((u=i[h-1]).length+=i[h].length,i.length-=1),u.type=A.WORD,u.subType=f):(l=!0,u.type=A.WORD,u.subType=A.LATIN):(l=!0,u.type=A.MENTION);else if(f===A.DIGIT)u.type===A.WORD?(l=!0,u.subType=A.MIXED):u.type===A.NUMBER?l=!0:1!=u.length||"+"!=r[u.st]&&"-"!=r[u.st]?1==u.length&&(","==r[u.st]||"."==r[u.st])&&1<i.length&&i[h-1].type===A.NUMBER&&(l=!0,(u=i[h-1]).length+=i[h].length,i.length-=1):(l=!0,0<h&&i[h-1].type===A.NUMBER&&((u=i[h-1]).length+=i[h].length,u.subType=A.RANGE,i.length-=1),u.type=A.NUMBER);else if(f===A.SPACE)u.type===A.SPACE&&(l=!0);else if(u.type===A.MARKUP&&r[u.st]==o&&-1<"=-~:*#`'>_".indexOf(o))l=!0;else if("."==o)e.links&&e.links.www&&3==u.length&&"www"==u.toLowerCase()&&(l=!0,u.type=A.LINK);else if(e.wiki&&"'"==o&&"'"==r[u.en()])1<u.length?(u.length--,p--,d=A.MARKUP):(l=!0,u.type=A.MARKUP);else if("-"==o||u.subType==A.LATIN&&("’"==o||"'"==o))u.type===A.WORD&&(l=!0);else if("/"==o)e.links&&e.links.protocols&&2<i.length&&i[h-2].type===A.WORD&&i[h-2].subType==A.LATIN&&1==i[h-1].length&&":"==r[i[h-1].st]&&1==i[h].length&&"/"==r[i[h].st]&&(l=!0,(u=i[h-2]).length+=i[h-1].length+i[h].length,u.allUpper=u.allUpper&&i[h-1].allUpper&&i[h].allUpper,u.type=A.LINK,i.length-=2);else if(e.html&&";"==o)0<h&&u.type===A.WORD&&1==i[h-1].length&&"&"==r[i[h-1].st]?(l=!0,(u=i[h-1]).length+=i[h].length,u.allUpper=u.allUpper&&i[h-1].allUpper,u.type=A.ENTITY,i.length-=1):1<h&&(u.type===A.WORD||u.type===A.NUMBER)&&1==i[h-1].length&&"#"==r[i[h-1].st]&&1==i[h-2].length&&"&"==r[i[h-2].st]&&(l=!0,(u=i[h-2]).length+=i[h-1].length+i[h].length,u.allUpper=u.allUpper&&i[h-1].allUpper&&i[h].allUpper,u.type=A.ENTITY,i.length-=2);else if(e.markdown&&"["==o&&1==u.length&&"!"==r[u.st])l=!0,u.type=A.MARKUP;else if(e.markdown&&"("==o&&1==u.length&&"]"==r[u.st])d=A.MARKUP,m=A.LINK;else if(e.wiki&&"{"==o&&1==u.length&&"{"==r[u.st])l=!0,u.type=A.MARKUP,u.subType=A.TEMPLATE;else if(e.wiki&&"["==o&&1==u.length&&"["==r[u.st])l=!0;else if(e.wiki&&"]"==o&&1==u.length&&"]"==r[u.st])l=!0;else if(e.wiki&&"|"==o&&!y){for(var b=-1,v=h-1;0<=v;v--){if(2==i[v].length&&"["==r[i[v].st]&&"["==r[i[v].st+1]){b=v;break}if(1==i[v].length&&"|"==r[i[v].st]||-1<i[v].indexOf("\n"))break}if(-1<b){l=!0;for(v=h-1;b<=v;v--)(u=i[v]).length+=i[v+1].length,u.allUpper=u.allUpper&&i[v+1].allUpper;h=b,i.length=h+1,u.subType=A.LINK}}}else l=!0;else l=!0,u.type=A.TAG,"!"==o?u.subType=A.COMMENT:"/"==o&&(u.subType=A.CLOSING);else l=!0,u.quote?o==u.quote&&"\\"!=r[u.en()]&&delete u.quote:'"'!=o&&"'"!=o||(u.quote=o);l?(u.length++,u.allUpper=u.allUpper&&g):(u=new x(r,p,s+1-p,i.length,g,g,d,m),i.push(u))}return this},A.prototype.done=function(t,e){if(!t)return this.tokens;for(var n=s(t,e),r=[],i=0;i<this.tokens.length;i++)n(this.tokens[i],i,this.tokens)&&r.push(this.tokens[i]);return r},A.prototype.count=function(t,e){if(!t)return this.tokens.length;for(var n=s(t,e),r=0,i=0;i<this.tokens.length;i++)n(this.tokens[i],i,this.tokens)&&r++;return r},A.prototype.nextToken=function(t,e,n){var r=s(e,n),i=this.index;for(i++;i<this.tokens.length&&r(this.tokens[i],i,this.tokens);)i++;return i<this.tokens.length?(t&&(this.index=i),this.tokens[i]):null},A.prototype.punctAhead=function(){var t=this.nextToken(!1,["SPACE"],!0);return t&&"PUNCT"==t.type&&t},A.prototype.prevToken=function(t,e,n){var r=s(e,n),i=this.index;for(i--;0<=i&&r(this.tokens[i],i,this.tokens);)i--;return 0<=i?(t&&(this.index=i),this.tokens[i]):null},A.prototype.punctBehind=function(){var t=this.prevToken(!1,["SPACE"],!0);return t&&"PUNCT"==t.type&&t},A.prototype.hasTokensAhead=function(t,e){return null!=this.nextToken(!1,t,e)},A.prototype.hasTokensBehind=function(t,e){return null!=this.prevToken(!1,t,e)},A});